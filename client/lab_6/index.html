<!DOCTYPE html>
<html lang='en'>
    <head>
        <meta charset='UTF-8'/>
        <title>INST377: Lab 6</title>
        <link rel='stylesheet' href='styles.css'>
    </head>
    <body>
        <h1>Nikeet Mittu Lab 6: Typeahead Entries</h1>
        <h2>Search the PGCounty Open Data Food Service Inspection API below:</h2>
        <form class="search-form">
            <input type="text" class="search" placeholder="Search">
            <ul class="suggestions"></ul>
        </form>
        <script>
            async function windowActions() {
            const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';
            
            const request = await fetch(endpoint)
            const cities = await request.json()
            
            
            function findMatches(wordToMatch, cities) {
              return cities.filter(place => {
                const regex = new RegExp(wordToMatch, 'gi');
                return place.city.match(regex) || place.state.match(regex)
              });
            }
            
            function numberWithCommas(x) {
              return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            }
            
            function displayMatches(event) {
              const matchArray = findMatches(this.value, cities);
              const html = matchArray.map(place => {
                const regex = new RegExp(this.value, 'gi');
                const cityName = place.city.replace(regex, `<span class="hl">${event.target.value}</span>`);
                const stateName = place.state.replace(regex, `<span class="hl">${event.target.value}</span>`);
                return `
                  <li>
                    <span class="name">${cityName}, ${stateName}</span>
                    <span class="population">${numberWithCommas(place.population)}</span>
                  </li>
                `;
              }).join('');
              suggestions.innerHTML = html;
            }
            
            const searchInput = document.querySelector('.search');
            const suggestions = document.querySelector('.suggestions');
            
            searchInput.addEventListener('change', (evt) => { displayMatches(evt) });
            searchInput.addEventListener('keyup', (evt) => { displayMatches(evt) });
            }
            window.onload = windowActions;
            </script>
  </body>
</html>